<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.coggiri.main.mvc.repository.TagRepository">
    <insert id="createTag" parameterType="com.coggiri.main.mvc.domain.entity.Tag" useGeneratedKeys="true" keyColumn="tag_id" keyProperty="tagId">
        INSERT INTO tag(tag_name)
        SELECT t.name
        FROM (
        <foreach collection="tagNames" item="tag" separator=" UNION ALL ">
            SELECT #{tag} AS name
        </foreach>
        ) t
        WHERE NOT EXISTS (
        SELECT 1 FROM Tag WHERE name = t.name
        )
    </insert>

    <select id="getTagIds" resultType="Integer" parameterType="com.coggiri.main.mvc.domain.entity.Tag">
        SELECT tag_id
        FROM tag
        WHERE tag_name IN
        <foreach item="tagName" collection="tagNames" open="(" separator="," close=")">
            #{tagName}
        </foreach>
    </select>
    
    <select id="getTagNames" resultType="string" parameterType="list">
        SELECT tag_name
        FROM tag
        WHERE tag_id IN
        <foreach item="id" collection="list" open="(" separator="," close=")">
            #{id}
        </foreach>
    </select>
</mapper>